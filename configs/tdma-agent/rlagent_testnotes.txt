------------------------------------------------------------------------
 TEST NOTES
------------------------------------------------------------------------
ExtRaSy Example: DSA network with 1 base station and two mobiles. Base station uses a Reinforcement Learning agent to adaptively control spectrum access.
Test Date : 2014-02-20
Host Machine Names: sdrman ?,?,?
Node 1 on sdrman?
Node 2 on sdrman?
Node 2 on sdrman?


------------------------------------------------------------------------
 1) SETUP TEST DIRECTORIES
------------------------------------------------------------------------
Open a new terminal for each node. (hereafter called "terminal 1" for the node)
Enter each of the following in terminal 1 for all nodes
[No space before or after "=" sign on command lines calls]

export testdir=YOUR_PATH_HERE
export testnum=tdma-agent
export infodir="${testdir}/${testnum}"
export logsdir="${testdir}/${testnum}/logs"

mkdir -p "${logsdir}"


------------------------------------------------------------------------
 2) SETUP NETWORK TRAFFIC VARIABLES
------------------------------------------------------------------------
Open a new terminal for each node. (hereafter called "terminal 2" for the node)
Open tabs in terimanl 2 (as many as there are iperf calls for each node in Section 4 below)
Enter each of the following in each tab in terminal 2 (for each node)

export host_1=192.168.200.1
export host_2=192.168.200.2
export host_3=192.168.200.3

export port_1=5001
export port_2=5002
export port_3=5003


------------------------------------------------------------------------
 3) RADIO NODE COMMANDS
------------------------------------------------------------------------
Enter the following in terminal 1 of the appropriate node
[No space before or after "=" sign on command lines calls]

Node 1 _____________________________________________________________________
./tdma_agent.py -c "${infodir}/rlagent_node1.ini" 2>&1  | tee "${logsdir}/console_log_node1.txt"

Node 2 _____________________________________________________________________
./tdma_agent.py -c "${infodir}/rlagent_node2.ini" 2>&1  | tee "${logsdir}/console_log_node2.txt"

Node 3 _____________________________________________________________________
./tdma_agent.py -c "${infodir}/rlagent_node3.ini" 2>&1  | tee "${logsdir}/console_log_node3.txt"


------------------------------------------------------------------------
 4) NETWORK TRAFFIC COMMANDS
------------------------------------------------------------------------
Enter the following in terminal 2 of the appropriate node (one iperf call per tab)

Node 1 _____________________________________________________________________
iperf -u -f k -i 10 -l 500 -p $port_2 -c $host_2 -P 1 -b 100k -t285 | tee "${logsdir}/node1_iperf_client_to2.log"
iperf -u -f k -i 10 -l 500 -p $port_3 -c $host_3 -P 1 -b 100k -t285 | tee "${logsdir}/node1_iperf_client_to3.log"
iperf -u -f k -i 10 -l 500 -p $port_1 -s | tee "${logsdir}/node1_iperf_server.log"

Node 2 _____________________________________________________________________
iperf -u -f k -i 10 -l 500 -p $port_1 -c $host_1 -P 1 -b 100k -t285 | tee "${logsdir}/node2_iperf_client_to1.log"
iperf -u -f k -i 10 -l 500 -p $port_2 -s | tee "${logsdir}/node2_iperf_server.log"

Node 3 _____________________________________________________________________
iperf -u -f k -i 10 -l 500 -p $port_1 -c $host_1 -P 1 -b 100k -t285 | tee "${logsdir}/node3_iperf_client_to1.log"
iperf -u -f k -i 10 -l 500 -p $port_3 -s | tee "${logsdir}/node3_iperf_server.log"


------------------------------------------------------------------------
 5) REAL TIME LOG DISPLAY
------------------------------------------------------------------------
The RL Agent generates logs that can be displayed and updated in real time. 
Run the following to see dynamic updates of the agent state

From the ExtRaSy apps/tdma-agent directory
./agent_plotter.py --log-file=${logsdir}/agent_log_node1.log
./network_state_plotter.py --log-file=${logsdir}/db_log_node1.log

------------------------------------------------------------------------
 6) LOG POST PROCESSING
------------------------------------------------------------------------
Nodes generate logs that can be processed at the conclusion of a test
to get a detailed look at the node performance in a test. 

Run process_tdma_run.m in the ExtRaSy matlab directory, updating process_tdma_run.m
to point to the correct file locations

agent_plotter.py and network_state_plotter.py both have plot_log methods that
could be called from an interactive python session to produce Matplotlib figures
that can be easily modified. 

